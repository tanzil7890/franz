// Example 3: Test Counter (Solving the Test Suite Problem)
// Demonstrates: Practical use case for mutable refs in testing

(println "=== Test Counter Example ===")
(println "")

// Create counters for test results
passed = (ref 0)
failed = (ref 0)

// Helper to record test result
record_test = {name condition ->
  (if condition
    {->
      p = (deref passed)
      (set! passed (add p 1))
      (println "  ✓ PASS: " name)
    }
    {->
      f = (deref failed)
      (set! failed (add f 1))
      (println "  ✗ FAIL: " name)
    }
  )
}

// Run some tests
(println "Running tests...")
(record_test "add works" (is (add 2 2) 4))
(record_test "subtract works" (is (subtract 10 3) 7))
(record_test "multiply works" (is (multiply 5 3) 15))
(record_test "less_than works" (less_than 5 10))
(record_test "intentional fail" (is 1 2))
(record_test "greater_than works" (greater_than 20 10))

// Print summary
(println "")
(println "=== Test Summary ===")
total = (add (deref passed) (deref failed))
(println "Total: " total)
(println "Passed: " (deref passed))
(println "Failed: " (deref failed))

(if (is (deref failed) 0)
  {-> (println "✓ ALL TESTS PASSED!")}
  {-> (println "✗ Some tests failed")}
)
