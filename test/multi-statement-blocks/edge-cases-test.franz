// Multi-Statement Blocks Edge Cases Test Suite
// Tests corner cases, error conditions, and complex scenarios

(println "=== Multi-Statement Blocks Edge Cases ===")
(println "")

// EDGE CASE 1: Empty statements before return
(println "EDGE 1: Minimal block (just return)")
result1 = (if 1
  {<- 42}
  {<- 0}
)
test1_pass = (is result1 42)
(println "  Result: " result1)
(println "  PASS: " test1_pass)
(println "")

// EDGE CASE 2: Very long statement sequence
(println "EDGE 2: Long statement sequence (10 statements)")
result2 = (if 1
  {
    v1 = 1
    v2 = (add v1 1)
    v3 = (add v2 1)
    v4 = (add v3 1)
    v5 = (add v4 1)
    v6 = (add v5 1)
    v7 = (add v6 1)
    v8 = (add v7 1)
    v9 = (add v8 1)
    <- v9
  }
  {<- 0}
)
test2_pass = (is result2 9)
(println "  Result: " result2)
(println "  PASS: " test2_pass)
(println "")

// EDGE CASE 3: Side effects with no return (should return void)
(println "EDGE 3: Mixed parameter and parameterless functions")
with_param = {x -> <- (multiply x 2)}
no_param = {<- 42}
result3a = (with_param 5)
result3b = (no_param)
test3_pass = (and (is result3a 10) (is result3b 42))
(println "  With param: " result3a " No param: " result3b)
(println "  PASS: " test3_pass)
(println "")

// EDGE CASE 4: Blocks with recursive calls
(println "EDGE 4: Recursive function in block")
factorial = {n ->
  <- (if (is n 0)
    {<- 1}
    {
      prev = (factorial (subtract n 1))
      <- (multiply n prev)
    }
  )
}
result4 = (factorial 5)
test4_pass = (is result4 120)
(println "  Factorial(5): " result4)
(println "  PASS: " test4_pass)
(println "")

// EDGE CASE 5: Multiple returns (only last one should execute)
(println "EDGE 5: Single return per block (last value)")
result5 = (if 1
  {
    val1 = 10
    val2 = 20
    val3 = 30
    <- val3
  }
  {<- 0}
)
test5_pass = (is result5 30)
(println "  Result: " result5)
(println "  PASS: " test5_pass)
(println "")

// EDGE CASE 6: Blocks with all types
(println "EDGE 6: All Franz types in blocks")
result6a = (if 1 {<- 42} {<- 0})
result6b = (if 1 {<- 3.14} {<- 0.0})
result6c = (if 1 {<- "text"} {<- ""})
result6d = (if 1 {<- (list 1 2 3)} {<- (list)})
fn = {<- 99}
result6e = (if 1 {<- fn} {<- fn})
result6f = (result6e)
test6_pass = (and (and (is result6a 42) (is result6b 3.14)) (and (is result6c "text") (is result6f 99)))
(println "  Int: " result6a " Float: " result6b " String: " result6c " Function result: " result6f)
(println "  PASS: " test6_pass)
(println "")

// EDGE CASE 7: Closure creation in block
(println "EDGE 7: Closure creation in block")
outer_val = 100
create_closure = (if 1
  {
    (println "  Creating closure that captures outer_val")
    <- {x -> <- (add x outer_val)}
  }
  {
    <- {x -> <- 0}
  }
)
result7 = (create_closure 5)
test7_pass = (is result7 105)
(println "  Result: " result7)
(println "  PASS: " test7_pass)
(println "")

// EDGE CASE 8: Multi-clause if with blocks
(println "EDGE 8: Multi-clause if with multi-statement blocks")
score = 85
grade = (if (greater_than score 90)
  {
    (println "  Excellent!")
    <- "A"
  }
  (greater_than score 80)
  {
    (println "  Very Good!")
    <- "B"
  }
  {
    (println "  Good")
    <- "C"
  }
)
test8_pass = (is grade "B")
(println "  Grade: " grade)
(println "  PASS: " test8_pass)
(println "")

// EDGE CASE 9: Standalone multi-statement function calls
(println "EDGE 9: Standalone multi-statement function")
process = {x ->
  doubled = (multiply x 2)
  tripled = (multiply x 3)
  (println "  x=" x " doubled=" doubled " tripled=" tripled)
  <- (add doubled tripled)
}
result9 = (process 3)
test9_pass = (is result9 15)
(println "  Result: " result9)
(println "  PASS: " test9_pass)
(println "")

// EDGE CASE 10: Nested blocks (3 levels deep)
(println "EDGE 10: Triple-nested blocks")
result10 = (if 1
  {
    level1 = (if 1
      {
        level2 = (if 1
          {
            (println "  Reached level 3")
            <- 333
          }
          {<- 0}
        )
        <- level2
      }
      {<- 0}
    )
    <- level1
  }
  {<- 0}
)
test10_pass = (is result10 333)
(println "  Result: " result10)
(println "  PASS: " test10_pass)
(println "")

// EDGE CASE 11: Block with println side effects
(println "EDGE 11: Block with println side effects")
result11 = (if 1
  {
    (println "  Executing true branch")
    <- "executed"
  }
  {
    (println "  Should not print")
    <- "skipped"
  }
)
test11_pass = (is result11 "executed")
(println "  Result: " result11)
(println "  PASS: " test11_pass)
(println "")

// EDGE CASE 12: Complex expression as return value
(println "EDGE 12: Complex expression return")
lst = (list 10 20 30)
result12 = (if 1
  {
    a = (head lst)
    b = (head (tail lst))
    c = (head (tail (tail lst)))
    <- (add (add a b) c)
  }
  {<- 0}
)
test12_pass = (is result12 60)
(println "  Sum: " result12)
(println "  PASS: " test12_pass)
(println "")

// Summary
(println "")
(println "=== EDGE CASES SUMMARY ===")
total = (add (add (add test1_pass test2_pass) (add test3_pass test4_pass)) (add (add (add test5_pass test6_pass) (add test7_pass test8_pass)) (add (add test9_pass test10_pass) (add test11_pass test12_pass))))
(println "Edge cases passed: " total " / 12")
all_pass = (is total 12)
(println "All edge cases passed: " all_pass)
