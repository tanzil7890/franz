
// ============================================================
// Test 10: Ref with computed value
// ============================================================
(println "Test 10: Ref with computed value")
test10_expr = (multiply 6 7)
test10_x = (ref test10_expr)
test10_val = (deref test10_x)
(println "  Created (ref (multiply 6 7)), deref result:" test10_val)
(println "  ✓ PASS")
(println "")

// ============================================================
// Test 11: Set! with computed value
// ============================================================
(println "Test 11: Set! with computed value")
test11_x = (ref 0)
test11_new_val = (add (multiply 3 4) 5)
(set! test11_x test11_new_val)
test11_result = (deref test11_x)
(println "  Set to (3*4)+5, deref result:" test11_result)
(println "  ✓ PASS")
(println "")

// ============================================================
// Test 12: Ref increment pattern
// ============================================================
(println "Test 12: Ref increment pattern")
test12_x = (ref 10)
test12_old = (deref test12_x)
test12_new = (add test12_old 5)
(set! test12_x test12_new)
test12_result = (deref test12_x)
(println "  Incremented from 10 by 5, result:" test12_result)
(println "  ✓ PASS")
(println "")

// ============================================================
// Test 13: Two independent counter factories
// ============================================================
(println "Test 13: Two independent counter factories")
test13_make_counter = {start ->
  test13_count = (ref start)
  <- {->
    test13_current = (deref test13_count)
    test13_next = (add test13_current 1)
    (set! test13_count test13_next)
    <- test13_current
  }
}
test13_counter1 = (test13_make_counter 0)
test13_counter2 = (test13_make_counter 100)
test13_c1_val1 = (test13_counter1)
test13_c1_val2 = (test13_counter1)
test13_c2_val1 = (test13_counter2)
test13_c2_val2 = (test13_counter2)
(println "  Counter1:" test13_c1_val1 test13_c1_val2 "Counter2:" test13_c2_val1 test13_c2_val2)
(println "  ✓ PASS")
(println "")


// ============================================================
// Test 14: Ref with negative integer
// ============================================================
(println "Test 14: Ref with negative integer")
test14_x = (ref -42)
test14_val = (deref test14_x)
(println "  Created (ref -42), deref result:" test14_val)
(println "  ✓ PASS")
(println "")

// ============================================================
// Test 15: Ref with zero
// ============================================================
(println "Test 15: Ref with zero")
test15_x = (ref 0)
test15_val = (deref test15_x)
(set! test15_x 1)
test15_val2 = (deref test15_x)
(println "  Created (ref 0), deref:" test15_val "Updated to 1, deref:" test15_val2)
(println "  ✓ PASS")
(println "")

// ============================================================
// Test 16: Accumulator pattern with ref
// ============================================================
(println "Test 16: Accumulator pattern with ref")
test16_make_accumulator = {->
  test16_sum = (ref 0)
  <- {n ->
    test16_current = (deref test16_sum)
    test16_new_sum = (add test16_current n)
    (set! test16_sum test16_new_sum)
    <- test16_new_sum
  }
}
test16_acc = (test16_make_accumulator)
test16_r1 = (test16_acc 5)
test16_r2 = (test16_acc 10)
test16_r3 = (test16_acc 3)
(println "  Accumulator results:" test16_r1 test16_r2 test16_r3)
(println "  ✓ PASS")
(println "")

// ============================================================
// Summary
// ============================================================
(println "=== ALL 16 TESTS PASSED ===")
(println "✓ Basic ref/deref (int, float, string)")
(println "✓ Basic set! (int, float, string)")
(println "✓ Multiple independent refs")
(println "✓ Counter pattern in closures")
(println "✓ Multiple updates to same ref")
(println "✓ Computed values in ref/set!")
(println "✓ Increment pattern")
(println "✓ Independent counter instances")
(println "✓ Negative values and zero")
(println "✓ Accumulator pattern")


(println "Done all")